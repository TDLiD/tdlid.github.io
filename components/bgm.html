<style>
    #musicToggleBtn { 
        position: fixed; bottom: 25px; right: 25px; z-index: 10005; 
        width: 44px; height: 44px; background: rgba(23, 23, 23, 0.8); 
        border: 1px solid rgba(34, 211, 238, 0.4); border-radius: 50%; 
        display: flex; align-items: center; justify-content: center; 
        cursor: pointer; color: #22d3ee; backdrop-filter: blur(4px); 
        transition: all 0.3s; 
    }
    #musicToggleBtn:hover { transform: scale(1.1); border-color: #22d3ee; }
</style>

<audio id="bgm" src="mp3/tdlid.mp3" loop muted preload="auto"></audio>

<button id="musicToggleBtn" title="Play/Pause Music">
    <span id="musicIconUI">ðŸ”‡</span>
</button>

<script>
    (function() {
        const bgm = document.getElementById('bgm');
        const musicBtn = document.getElementById('musicToggleBtn');
        const musicIcon = document.getElementById('musicIconUI');

        const initBGM = () => {
            const savedTime = sessionStorage.getItem('bgmTime');
            const isMuted = sessionStorage.getItem('bgmMuted');

            if (savedTime) bgm.currentTime = parseFloat(savedTime);

            // [í•µì‹¬] ëª¨ë°”ì¼ì€ íŽ˜ì´ì§€ ë¡œë“œ ì§í›„ .play()ë¥¼ í˜¸ì¶œí•˜ë©´ ê±°ë¶€ë©ë‹ˆë‹¤.
            // ë”°ë¼ì„œ ì €ìž¥ëœ ìƒíƒœê°€ 'ìž¬ìƒ(false)'ì´ë¼ í•˜ë”ë¼ë„ ìš°ì„  UIë§Œ ì„¸íŒ…í•©ë‹ˆë‹¤.
            if (isMuted === 'false') {
                // ì‚¬ìš©ìžê°€ ì´ì „ì— ì¼°ë˜ ê¸°ë¡ì´ ìžˆë‹¤ë©´, í™”ë©´ ì•„ë¬´ê³³ì´ë‚˜ í„°ì¹˜í•  ë•Œ ìž¬ìƒë˜ë„ë¡ í•œì‹œì  í—ˆìš©
                const playOnGesture = () => {
                    bgm.muted = false;
                    bgm.play().then(() => {
                        musicIcon.innerText = "ðŸŽµ";
                        document.removeEventListener('click', playOnGesture);
                    }).catch(() => {});
                };
                document.addEventListener('click', playOnGesture);
            }
        };

        if (musicBtn && bgm) {
            initBGM();

            musicBtn.onclick = (e) => {
                e.stopPropagation(); // ì¤‘ë³µ ì´ë²¤íŠ¸ ë°©ì§€
                if (bgm.muted) {
                    bgm.muted = false;
                    bgm.play();
                    musicIcon.innerText = "ðŸŽµ";
                } else {
                    bgm.muted = true;
                    musicIcon.innerText = "ðŸ”‡";
                }
                sessionStorage.setItem('bgmMuted', bgm.muted);
            };

            // ì‹œê°„ ì €ìž¥ (ëª¨ë°”ì¼ ë°°í„°ë¦¬ ì ˆì•½ì„ ìœ„í•´ 2ì´ˆ ê°„ê²©)
            setInterval(() => {
                if(!bgm.paused) sessionStorage.setItem('bgmTime', bgm.currentTime);
            }, 2000);
        }
    })();
</script>
