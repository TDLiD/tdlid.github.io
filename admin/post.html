<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>TDLiD Admin - Content Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        body { background-color: #020617; color: #e5e7eb; font-family: 'Pretendard', sans-serif; }
        
        /* 네비게이션 탭 스타일 */
        .tab-item {
            transition: all 0.3s ease;
            position: relative;
        }
        .tab-item.active {
            color: #22d3ee;
        }
        .tab-item.active::after {
            content: '';
            position: absolute;
            bottom: -25px;
            left: 0;
            width: 100%;
            height: 2px;
            background: #22d3ee;
            box-shadow: 0 0 10px #22d3ee;
        }

        /* 에디터 커스텀 */
        .ql-toolbar { background: #1e293b !important; border-radius: 8px 8px 0 0; border: 1px solid #334155 !important; }
        .ql-container { background: #0f172a !important; color: white; min-height: 300px; border: 1px solid #334155 !important; border-radius: 0 0 8px 8px; }
        .ql-editor.ql-blank::before { color: #64748b !important; }
        input, select { background: #0f172a !important; border: 1px solid #1e293b !important; color: white !important; outline: none; }
        input:focus { border-color: #0891b2 !important; }
    </style>
</head>
<body class="p-8">
    <div class="max-w-6xl mx-auto">
        <header class="mb-12 border-b border-cyan-900/50 pb-6 flex flex-col md:flex-row md:items-end justify-between gap-6">
            <div>
                <h1 class="text-4xl font-bold text-cyan-400 tracking-tighter italic">ADMIN SYSTEM</h1>
                <p class="text-neutral-500 text-sm mt-1 uppercase tracking-widest">TDL Energy Indonesia Management</p>
            </div>

            <nav class="flex gap-8 text-sm font-bold uppercase tracking-wider text-neutral-500">
                <a href="admin.html" class="tab-item hover:text-white transition">Dashboard</a>
                <a href="visitor.html" class="tab-item hover:text-white transition">Visitor</a>
                <a href="inquiry.html" class="tab-item hover:text-white transition">Inquiry</a>
                <a href="post.html" class="tab-item active hover:text-white transition">Posts</a>
                <a href="security.html" class="tab-item hover:text-white transition">Security</a>
            </nav>
        </header>

        <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold text-cyan-400">Content Management</h2>
            <button onclick="location.href='admin.html'" class="text-xs bg-neutral-800 hover:bg-neutral-700 text-neutral-300 px-4 py-1.5 rounded-lg transition">Dashboard</button>
        </div>
        
        <div class="bg-neutral-900/50 p-6 rounded-2xl border border-white/5 mb-8 shadow-xl">
            <input type="hidden" id="editKey">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                <select id="postCategory" class="p-3 rounded-lg text-cyan-400 font-bold">
                    <option value="notice">ANNOUNCEMENT</option>
                    <option value="news">LATEST NEWS</option>
                </select>
                <input type="text" id="noticeTitle" placeholder="Enter post title..." class="md:col-span-3 p-3 rounded-lg">
            </div>
            
            <div id="editor-container" class="mb-4 text-left"></div>
            
            <div class="flex gap-3">
                <button onclick="uploadNotice()" id="submitBtn" class="flex-grow py-4 bg-cyan-600 hover:bg-cyan-500 text-white font-black rounded-xl uppercase transition shadow-lg shadow-cyan-900/20">
                    Register Post
                </button>
                <button onclick="resetForm()" id="cancelBtn" class="hidden px-6 py-4 bg-neutral-800 text-neutral-400 font-bold rounded-xl hover:bg-neutral-700 transition">
                    Cancel
                </button>
            </div>
        </div>

        <div class="bg-neutral-900/80 rounded-2xl border border-white/5 overflow-hidden shadow-2xl">
            <div class="overflow-x-auto">
                <table class="w-full text-left">
                    <thead class="bg-white/5 text-[10px] uppercase tracking-widest text-neutral-500">
                        <tr>
                            <th class="p-5">Category</th>
                            <th class="p-5">Title</th>
                            <th class="p-5">Date</th>
                            <th class="p-5 text-center">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="noticeTableBody" class="divide-y divide-neutral-800 text-sm">
                        </tbody>
                </table>
            </div>
        </div>

        <div class="mt-12 text-center">
            <a href="../index.html" class="text-neutral-600 hover:text-cyan-400 text-xs transition">← Exit to Public Website</a>
        </div>
    </div>

    <script>
        // ... (Firebase Config 및 기존 스크립트 로직 동일)
        const firebaseConfig = {
            apiKey: "AIzaSyDwF8_Q9S1-naaAgyfMWhFYJ2u_be3wsBs",
            authDomain: "tdlid-107669.firebaseapp.com",
            databaseURL: "https://tdlid-107669-default-rtdb.firebaseio.com",
            projectId: "tdlid-107669",
            storageBucket: "tdlid-107669.firebasestorage.app",
            messagingSenderId: "604782345004",
            appId: "1:604782345004:web:029aeaa81f4d11c2254a89"
        };

        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const database = firebase.database();

        const quill = new Quill('#editor-container', {
            theme: 'snow',
            placeholder: 'Write your content here...',
            modules: {
                toolbar: [
                    [{ 'header': [1, 2, 3, false] }],
                    ['bold', 'italic', 'underline', 'strike'],
                    [{ 'color': [] }, { 'background': [] }],
                    ['link', 'image'],
                    ['clean']
                ]
            }
        });

        function loadPosts() {
            const tableBody = document.getElementById('noticeTableBody');
            tableBody.innerHTML = '<tr><td colspan="4" class="p-10 text-center text-neutral-500">Loading contents...</td></tr>';

            database.ref('notices').on('value', (snapshot) => {
                const noticeData = snapshot.val();
                let allPosts = [];
                if (noticeData) {
                    Object.keys(noticeData).forEach(key => {
                        const item = noticeData[key];
                        if (item && item.category) {
                            allPosts.push({ key: key, ...item });
                        }
                    });
                }
                allPosts.sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));
                renderTable(allPosts);
            });
        }

        function renderTable(data) {
            const tableBody = document.getElementById('noticeTableBody');
            tableBody.innerHTML = '';
            if (data.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="4" class="p-10 text-center text-neutral-500">No posts found.</td></tr>';
                return;
            }
            data.forEach(item => {
                const row = document.createElement('tr');
                row.className = "hover:bg-white/5 transition border-b border-white/5";
                row.innerHTML = `
                    <td class="p-5"><span class="px-2 py-1 rounded text-[10px] font-bold uppercase ${item.category === 'notice' ? 'bg-amber-900/30 text-amber-500' : 'bg-blue-900/30 text-blue-500'}">${item.category}</span></td>
                    <td class="p-5 font-bold text-neutral-200">${item.title || 'Untitled'}</td>
                    <td class="p-5 text-neutral-500 font-mono text-[10px]">${item.date || '-'}</td>
                    <td class="p-5 text-center text-xs">
                        <button onclick="editPost('${item.key}')" class="text-cyan-500 hover:text-cyan-300 mr-3 font-bold uppercase">Edit</button>
                        <button onclick="deletePost('${item.key}')" class="text-red-500 hover:text-red-300 font-bold uppercase">Delete</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        async function uploadNotice() {
            const category = document.getElementById('postCategory').value;
            const title = document.getElementById('noticeTitle').value;
            const content = quill.root.innerHTML;
            const editKey = document.getElementById('editKey').value;

            if (!title || quill.getText().trim().length === 0) { 
                alert("Please enter both title and content."); 
                return; 
            }

            const postData = {
                category: category,
                title: title,
                content: content,
                date: new Date().toISOString().split('T')[0],
                timestamp: Date.now()
            };

            try {
                if (editKey) {
                    await database.ref(`notices/${editKey}`).update(postData);
                    alert("Updated!");
                } else {
                    const newKey = `${category}_${Date.now()}`;
                    await database.ref(`notices/${newKey}`).set(postData);
                    alert("Registered!");
                }
                resetForm();
            } catch (error) {
                alert("Error: " + error.message);
            }
        }

        async function editPost(key) {
            const snap = await database.ref(`notices/${key}`).once('value');
            const data = snap.val();
            if(!data) return;
            document.getElementById('editKey').value = key;
            document.getElementById('postCategory').value = data.category;
            document.getElementById('noticeTitle').value = data.title;
            quill.root.innerHTML = data.content;
            document.getElementById('submitBtn').innerText = "Update Post";
            document.getElementById('cancelBtn').classList.remove('hidden');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        async function deletePost(key) {
            if (confirm("Delete this post?")) {
                await database.ref(`notices/${key}`).remove();
            }
        }

        function resetForm() {
            document.getElementById('editKey').value = '';
            document.getElementById('noticeTitle').value = '';
            quill.root.innerHTML = '';
            document.getElementById('submitBtn').innerText = "Register Post";
            document.getElementById('cancelBtn').classList.add('hidden');
        }

        document.addEventListener('DOMContentLoaded', loadPosts);
    </script>
</body>
</html>