<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>TDLiD Admin - Secure Access</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        .cyber-border { border: 1px solid rgba(34, 211, 238, 0.2); }
        body { background-color: #020617; font-family: 'Pretendard', sans-serif; display: none; } /* 초기엔 화면 숨김 */
    </style>
</head>
<body class="text-neutral-200 p-5 md:p-10" id="adminBody">

    <div class="max-w-7xl mx-auto">
        <header class="flex justify-between items-center mb-10 border-b border-cyan-900/50 pb-6">
            <div>
                <h1 class="text-3xl font-bold text-cyan-400 tracking-tighter">Visitor Analytics</h1>
                <p class="text-neutral-500 text-sm mt-1">Authorized Personnel Only</p>
            </div>
            <button onclick="location.reload()" class="px-4 py-2 bg-cyan-900/30 border border-cyan-500/50 text-cyan-400 rounded-lg hover:bg-cyan-500 hover:text-black transition">Refresh</button>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-10">
            <div class="bg-neutral-900/50 p-6 rounded-2xl cyber-border">
                <p class="text-neutral-500 text-xs font-bold tracking-widest uppercase">Total Visits</p>
                <h2 id="totalCount" class="text-4xl font-bold text-white mt-2">0</h2>
            </div>
        </div>

        <div class="bg-neutral-900/80 rounded-2xl cyber-border overflow-hidden">
            <div class="overflow-x-auto">
                <table class="w-full text-left">
                    <thead>
                        <tr class="bg-cyan-950/40 text-cyan-300 text-xs uppercase tracking-widest">
                            <th class="p-5">Time / IP</th>
                            <th class="p-5">Location</th>
                            <th class="p-5">Page</th>
                            <th class="p-5">Device</th>
                            <th class="p-5">Referrer</th>
                        </tr>
                    </thead>
                    <tbody id="visitTableBody" class="divide-y divide-neutral-800 text-sm"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // ======= 1. 보안 설정 (비밀번호) =======
        const ADMIN_PASSWORD = "tdlid_2026"; // <--- 사용할 비밀번호를 여기서 수정하세요!

        function checkAccess() {
            const entry = prompt("관리자 비밀번호를 입력하세요:");
            if (entry === ADMIN_PASSWORD) {
                document.body.style.display = "block"; // 비밀번호 일치 시 화면 표시
                loadFirebaseData();
            } else {
                alert("접근 권한이 없습니다.");
                window.location.href = "index.html"; // 메인으로 리다이렉트
            }
        }

        // ======= 2. Firebase 데이터 로드 =======
        function loadFirebaseData() {
            const firebaseConfig = {
                apiKey: "AIzaSyDwF8_Q9S1-naaAgyfMWhFYJ2u_be3wsBs",
                authDomain: "tdlid-107669.firebaseapp.com",
                databaseURL: "https://tdlid-107669-default-rtdb.firebaseio.com",
                projectId: "tdlid-107669",
                storageBucket: "tdlid-107669.firebasestorage.app",
                messagingSenderId: "604782345004",
                appId: "1:604782345004:web:029aeaa81f4d11c2254a89"
            };

            firebase.initializeApp(firebaseConfig);
            const database = firebase.database();
            const tableBody = document.getElementById('visitTableBody');
            const totalCountEl = document.getElementById('totalCount');

            database.ref('visits').orderByChild('timestamp').limitToLast(100).on('value', (snapshot) => {
                tableBody.innerHTML = '';
                let data = [];
                snapshot.forEach((childSnapshot) => {
                    data.unshift(childSnapshot.val()); 
                });

                totalCountEl.innerText = snapshot.numChildren();

                data.forEach((visit) => {
                    const row = `
                        <tr class="hover:bg-white/5 transition">
                            <td class="p-5 text-neutral-400">
                                <div class="font-mono text-xs">${visit.timeStr}</div>
                                <div class="text-cyan-600 text-[11px] font-bold mt-1">${visit.ip || '0.0.0.0'}</div>
                            </td>
                            <td class="p-5 text-white font-medium">${visit.country || 'Unknown'} (${visit.city || '-'})</td>
                            <td class="p-5 font-bold text-cyan-400">${visit.page}</td>
                            <td class="p-5"><span class="px-2 py-1 rounded text-[10px] bg-blue-900/30 text-blue-400">${visit.device}</span></td>
                            <td class="p-5 text-neutral-500 italic text-xs truncate max-w-[150px]">${visit.referrer}</td>
                        </tr>
                    `;
                    tableBody.innerHTML += row;
                });
            });
        }

        // 페이지 로드 시 즉시 보안 체크 실행
        window.onload = checkAccess;
    </script>
</body>
</html>