<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <title>Notice | TDL Energy Indonesia</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <link rel="stylesheet" href="css/main.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@300;400;600;700&display=swap" rel="stylesheet">

    <style>
        /* 전체 페이지 모바일 최적화 */
        body {
            background-color: #0a0a0a;
            color: #f5f5f5;
            font-family: 'Pretendard', sans-serif;
            overflow-x: hidden;
            -webkit-user-select: none;
            user-select: none;
        }

        .hero-slogan-gradient {
            background: linear-gradient(135deg, #fff 0%, #94a3b8 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* 공지사항 아이템 모바일 스타일 */
        .notice-item {
            background-color: rgba(23, 23, 23, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 1rem;
            margin-bottom: 0.75rem;
            overflow: hidden;
            transition: background-color 0.3s ease;
        }

        .notice-item:active {
            background-color: rgba(38, 38, 38, 0.8);
        }

        .notice-content {
            max-height: 0;
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            background-color: rgba(0, 0, 0, 0.3);
        }

        .notice-item.active .notice-content {
            max-height: 2000px;
            padding: 1.25rem 1.5rem;
            border-top: 1px solid rgba(6, 182, 212, 0.15);
        }

        .arrow-icon {
            transition: transform 0.3s ease;
            color: rgba(6, 182, 212, 0.6);
        }

        .notice-item.active .arrow-icon {
            transform: rotate(180deg);
            color: #22d3ee;
        }

        /* 내용 부분은 텍스트 복사 허용 */
        .notice-content-text {
            user-select: text;
            -webkit-user-select: text;
        }
    </style>
</head>

<body class="min-h-screen flex flex-col">
    <div id="bgm-placeholder"></div>
    <div id="header-placeholder"></div>

    <main class="pt-24 pb-12 px-5 flex-grow">
        <div class="max-w-full mx-auto pt-4">
            <h2 class="text-3xl font-bold tracking-tight hero-slogan-gradient mb-8 px-1 italic uppercase">
                Notice
            </h2>

            <div id="noticeList" class="flex flex-col gap-1">
                <div class="flex flex-col items-center justify-center py-20 space-y-4">
                    <div class="w-8 h-8 border-4 border-cyan-500/30 border-t-cyan-500 rounded-full animate-spin"></div>
                    <p class="text-neutral-500 font-medium tracking-widest text-xs uppercase">Loading Notices...</p>
                </div>
            </div>

            <div class="mt-12 text-center pb-10">
                <a href="index.html" class="inline-block px-8 py-3 rounded-xl border border-neutral-800 bg-neutral-900/50 text-neutral-400 text-sm font-medium active:scale-95 transition-all">
                    ← Back to Home
                </a>
            </div>
        </div>
    </main>

    <div id="footer-placeholder"></div>

    <script>
        /**
         * 1. 모바일 전용 레이아웃 로드 (_m 버전 호출)
         */
        async function loadLayout() {
            try {
                const [h, f, b] = await Promise.all([
                    fetch('components/header_m.html'),
                    fetch('components/footer_m.html'),
                    fetch('components/bgm_m.html')
                ]);
                document.getElementById('header-placeholder').innerHTML = await h.text();
                document.getElementById('footer-placeholder').innerHTML = await f.text();
                
                const bgmP = document.getElementById('bgm-placeholder');
                bgmP.innerHTML = await b.text();
                bgmP.querySelectorAll("script").forEach(s => {
                    const ns = document.createElement("script");
                    ns.text = s.text;
                    document.body.appendChild(ns).parentNode.removeChild(ns);
                });
                
                if (typeof initMenuToggle === 'function') initMenuToggle();
            } catch (e) {
                console.error("Layout load failed:", e);
            }
        }

        /**
         * 2. Firebase 설정 및 데이터 로딩
         */
        const firebaseConfig = {
            apiKey: "AIzaSyDwF8_Q9S1-naaAgyfMWhFYJ2u_be3wsBs",
            authDomain: "tdlid-107669.firebaseapp.com",
            databaseURL: "https://tdlid-107669-default-rtdb.firebaseio.com",
            projectId: "tdlid-107669",
            storageBucket: "tdlid-107669.firebasestorage.app",
            messagingSenderId: "604782345004",
            appId: "1:604782345004:web:029aeaa81f4d11c2254a89"
        };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        function toggleNotice(element) {
            const item = element.closest('.notice-item');
            const isActive = item.classList.contains('active');
            
            // 다른 열려있는 항목 닫기
            document.querySelectorAll('.notice-item').forEach(el => el.classList.remove('active'));
            
            // 현재 항목 토글
            if (!isActive) {
                item.classList.add('active');
                // 클릭 시 해당 위치로 부드럽게 스크롤 (선택 사항)
                setTimeout(() => {
                    item.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }, 300);
            }
        }

        database.ref('notices').on('value', (snapshot) => {
            const noticeList = document.getElementById('noticeList');
            noticeList.innerHTML = '';

            if (!snapshot.exists()) {
                noticeList.innerHTML = '<p class="text-center text-neutral-600 py-20 text-sm">No notices registered.</p>';
                return;
            }

            let notices = [];
            snapshot.forEach((child) => {
                const data = child.val();
                notices.push(data);
            });

            notices.sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));

            let finalHtml = '';
            notices.forEach((notice, index) => {
                const num = notices.length - index;
                const displayNum = num < 10 ? '0' + num : num;

                finalHtml += `
                <div class="notice-item">
                    <div class="flex flex-col px-5 py-5 cursor-pointer active:bg-white/5" onclick="toggleNotice(this)">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-cyan-500 font-mono text-xs font-bold">${displayNum}</span>
                            <div class="flex items-center gap-2">
                                <span class="text-neutral-500 font-mono text-[10px] uppercase">${notice.date}</span>
                                <span class="text-neutral-700 text-[10px]">|</span>
                                <span class="text-cyan-500/80 font-mono text-[10px] font-bold tracking-widest uppercase">Admin</span>
                            </div>
                        </div>
                        
                        <div class="flex items-start justify-between gap-3">
                            <h2 class="text-white font-semibold text-[15px] leading-snug break-words flex-1">
                                ${notice.title}
                            </h2>
                            <svg class="arrow-icon w-4 h-4 mt-1 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </div>
                    </div>
                    <div class="notice-content">
                        <div class="notice-content-text text-neutral-300 text-sm leading-relaxed whitespace-pre-wrap border-l-2 border-cyan-500/40 pl-4 py-1">
                            ${notice.content}
                        </div>
                    </div>
                </div>`;
            });
            noticeList.innerHTML = finalHtml;
        });

        /**
         * 3. 모바일 메뉴 제어 로직
         */
        function initMenuToggle() {
            const menuBtn = document.getElementById("menuToggleBtn");
            const dropdown = document.getElementById("dropdownMenu");
            const menuIcon = document.getElementById("menuIcon");

            if (menuBtn && dropdown) {
                menuBtn.onclick = (e) => {
                    e.stopPropagation();
                    const isOpen = dropdown.classList.contains("opacity-100");
                    if (!isOpen) {
                        dropdown.classList.remove("opacity-0", "invisible", "translate-y-[-10px]");
                        dropdown.classList.add("opacity-100", "visible", "translate-y-2");
                        if(menuIcon) menuIcon.innerText = "✕";
                    } else {
                        closeMenu();
                    }
                };

                function closeMenu() {
                    dropdown.classList.remove("opacity-100", "visible", "translate-y-2");
                    dropdown.classList.add("opacity-0", "invisible", "translate-y-[-10px]");
                    if(menuIcon) menuIcon.innerText = "☰";
                }

                document.addEventListener("click", () => closeMenu());
            }
        }

        // 보안: 우클릭 방지
        document.addEventListener('contextmenu', e => e.preventDefault());
        
        // 초기 로드 실행
        document.addEventListener("DOMContentLoaded", loadLayout);
    </script>
</body>

</html>