<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <title>Notice | TDL Energy Indonesia</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <link rel="stylesheet" href="css/main.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@300;400;600;700&display=swap" rel="stylesheet">

    <style>
        /* 전체 페이지 모바일 최적화 */
        body {
            background-color: #0a0a0a;
            color: #f5f5f5;
            font-family: 'Pretendard', sans-serif;
            overflow-x: hidden;
            -webkit-user-select: none;
            user-select: none;
        }

        /* 데스크톱 스타일 반영: 사이안 그래디언트 */
        .hero-slogan-gradient {
            background: linear-gradient(135deg, #22d3ee 0%, #10b981 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: inline-block;
            padding-right: 0.15em;
        }

        /* 공지사항 아이템 모바일 스타일 */
        .notice-item {
            background-color: rgba(23, 23, 23, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 1rem;
            margin-bottom: 0.5rem; /* 데스크톱 피드백 반영 축소 */
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .notice-item:active {
            background-color: rgba(38, 38, 38, 0.8);
        }

        .notice-content {
            max-height: 0;
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            background-color: rgba(0, 0, 0, 0.3);
        }

        .notice-item.active .notice-content {
            max-height: 3000px;
            padding: 1.25rem 1.5rem;
            border-top: 1px solid rgba(6, 182, 212, 0.15);
        }

        .arrow-icon {
            transition: transform 0.3s ease;
            color: rgba(6, 182, 212, 0.6);
        }

        .notice-item.active .arrow-icon {
            transform: rotate(180deg);
            color: #22d3ee;
        }

        .notice-content-inner {
            user-select: text;
            -webkit-user-select: text;
            white-space: normal;
        }

        .notice-content-inner img {
            max-width: 100%;
            height: auto;
            border-radius: 0.5rem;
            margin: 0.75rem 0;
            display: block;
        }
    </style>
</head>

<body class="min-h-screen flex flex-col">
    <div id="header-placeholder"></div>

    <main class="pt-24 pb-12 px-5 flex-grow">
        <div class="max-w-full mx-auto pt-4">
            <h2 class="text-3xl font-black tracking-tight hero-slogan-gradient mb-8 px-1 italic uppercase">
                Notice
            </h2>

            <div id="noticeList" class="flex flex-col gap-1">
                <div class="flex flex-col items-center justify-center py-20 space-y-4">
                    <div class="w-8 h-8 border-4 border-cyan-500/30 border-t-cyan-500 rounded-full animate-spin"></div>
                    <p class="text-neutral-500 font-medium tracking-widest text-xs uppercase">Fetching All Data...</p>
                </div>
            </div>

            <div class="mt-12 text-center pb-10">
                <a href="index.html" class="inline-block px-8 py-3 rounded-xl border border-neutral-800 bg-neutral-900/50 text-neutral-400 text-sm font-medium active:scale-95 transition-all">
                    &larr; Back to Home
                </a>
            </div>
        </div>
    </main>

    <div id="footer-placeholder"></div>

    <script>
        // 레이아웃 로드
 async function loadLayout() {
    try {
        const [h, f] = await Promise.all([
            fetch('components/header_m.html'),
            fetch('components/footer_m.html')
        ]);
        
        // 헤더 삽입
        document.getElementById('header-placeholder').innerHTML = await h.text();
        
        // 푸터 삽입
        const footerHTML = await f.text();
        const footerPlaceholder = document.getElementById('footer-placeholder');
        footerPlaceholder.innerHTML = footerHTML;

        // [중요] 푸터 내부에 포함된 <script> 태그를 강제로 실행시킴
        const scripts = footerPlaceholder.querySelectorAll("script");
        scripts.forEach(oldScript => {
            const newScript = document.createElement("script");
            newScript.text = oldScript.text; // 소스 코드 복사
            document.body.appendChild(newScript).parentNode.removeChild(newScript);
        });
        
        if (typeof initMenuToggle === 'function') initMenuToggle();
    } catch (e) {
        console.error("Layout load failed:", e);
    }
}

        // Firebase 설정
        const firebaseConfig = {
            apiKey: "AIzaSyDwF8_Q9S1-naaAgyfMWhFYJ2u_be3wsBs",
            authDomain: "tdlid-107669.firebaseapp.com",
            databaseURL: "https://tdlid-107669-default-rtdb.firebaseio.com",
            projectId: "tdlid-107669",
            storageBucket: "tdlid-107669.firebasestorage.app",
            messagingSenderId: "604782345004",
            appId: "1:604782345004:web:029aeaa81f4d11c2254a89"
        };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // 아코디언 토글
        function toggleNotice(element) {
            const item = element.closest('.notice-item');
            const isActive = item.classList.contains('active');
            document.querySelectorAll('.notice-item').forEach(el => el.classList.remove('active'));
            
            if (!isActive) {
                item.classList.add('active');
                setTimeout(() => {
                    item.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }, 300);
            }
        }

        // Firebase 데이터 로드 및 렌더링 (추가된 필터링 기능 적용)
        database.ref('notices').on('value', (snapshot) => {
            const noticeList = document.getElementById('noticeList');
            noticeList.innerHTML = '';

            if (!snapshot.exists()) {
                noticeList.innerHTML = '<p class="text-center text-neutral-600 py-20 text-sm">No notices registered.</p>';
                return;
            }

            let notices = [];
            snapshot.forEach((child) => {
                const data = child.val();
                // [추가 기능] 카테고리가 'notice'인 것만 추출
                if (data.category === 'notice') {
                    notices.push(data);
                }
            });

            // [추가 기능] 공지사항이 없을 경우 예외 처리
            if (notices.length === 0) {
                noticeList.innerHTML = '<p class="text-center text-neutral-600 py-20 text-sm">No notices registered.</p>';
                return;
            }

            // 최신순 정렬
            notices.sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));

            let finalHtml = '';
            notices.forEach((notice, index) => {
                const currentNum = index + 1;
                const displayNum = currentNum < 10 ? '0' + currentNum : currentNum;

                finalHtml += `
                <div class="notice-item">
                    <div class="flex flex-col px-5 py-5 cursor-pointer active:bg-white/5" onclick="toggleNotice(this)">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-cyan-500 font-mono text-xs font-bold">${displayNum}.</span>
                            <div class="flex items-center gap-2">
                                <span class="text-neutral-500 font-mono text-[10px] uppercase">${notice.date}</span>
                                <span class="text-neutral-700 text-[10px]">|</span>
                                <span class="text-cyan-500/80 font-mono text-[10px] font-bold tracking-widest uppercase">Admin</span>
                            </div>
                        </div>
                        <div class="flex items-start justify-between gap-3">
                            <h2 class="text-white font-semibold text-[15px] leading-snug break-words flex-1">
                                ${notice.title}
                            </h2>
                            <svg class="arrow-icon w-4 h-4 mt-1 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </div>
                    </div>
                    <div class="notice-content">
                        <div class="notice-content-inner text-neutral-300 text-sm leading-relaxed border-l-2 border-cyan-500/40 pl-4 py-1">
                            ${notice.content}
                        </div>
                    </div>
                </div>`;
            });
            noticeList.innerHTML = finalHtml;
        });

        // 메뉴 토글
        function initMenuToggle() {
            const menuBtn = document.getElementById("menuToggleBtn");
            const dropdown = document.getElementById("dropdownMenu");
            const menuIcon = document.getElementById("menuIcon");

            if (menuBtn && dropdown) {
                menuBtn.onclick = (e) => {
                    e.stopPropagation();
                    const isOpen = dropdown.classList.contains("opacity-100");
                    if (!isOpen) {
                        dropdown.classList.remove("opacity-0", "invisible", "translate-y-[-10px]");
                        dropdown.classList.add("opacity-100", "visible", "translate-y-2");
                        if(menuIcon) menuIcon.innerText = "✕";
                    } else {
                        closeMenu();
                    }
                };
                function closeMenu() {
                    dropdown.classList.remove("opacity-100", "visible", "translate-y-2");
                    dropdown.classList.add("opacity-0", "invisible", "translate-y-[-10px]");
                    if(menuIcon) menuIcon.innerText = "☰";
                }
                document.addEventListener("click", () => closeMenu());
            }
        }

        document.addEventListener('contextmenu', e => e.preventDefault());
        document.addEventListener("DOMContentLoaded", loadLayout);
    </script>
</body>
</html>